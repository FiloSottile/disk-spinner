# disk-spinner - a stress-test tool for spinning rust HDDs

If you set up a new mechanical disk that you take fresh out of the package and slot it into your NAS, do you ask yourself whether the data on it will be safe? I personally enjoy knowing about problems with my storage hardware before it contains any important data, and so do a bunch of folks who run machines with lots of drives in them!

There's a pretty decent procedure that I'd been using to burn-in my HDDs, taken from [this forum thread](https://www.truenas.com/community/resources/hard-drive-burn-in-testing.92/); it was fine in 2014 but these days, HDDs in excess of 18TiB exist, and on those badblocks runs into a limitation of its block offset representation. (Besides, badblocks is really slow.)

Hence, this tool: disk-spinner.

## What does this do?

It destructively writes blocks of random data  to an entire disk device (or, optionally, just a partition; but you'll probably want the whole drive), then verifies that the data matches what's been written.

If any data could not be read exactly as written, it informs you in big letters. That means your disk is bad & you should make use of your vendor's RMA policy. Doesn't it feel great to not run into problems?

## The name

This tool is for spinning disks; it's also a play on the German word "Spinner" (a goofball), referring to me - a person goofy about disks.

## Why?

First of all, [the 18TiB issue](https://www.reddit.com/r/DataHoarder/comments/fbst8m/alternative_to_badblocks/). I'd been using zfs (write random data, `zpool scrub`) to validate the data in the meantime; but unfortunately, that reserves a good chunk of space on the volume which will remain untested. So, here we are.

I also wanted to make something that does a bunch of error-checking before it'll let me super-destructively overwrite data on a drive: This tool does check that it's running on a bare disk drive with a rotational medium. (TODO: check that the disk has no partition table - we really only want to run on fresh disks)

Also, performance is not bad at all: The random data that is getting written is generated by encrypting zeroes with AES-128-CTR, based on a key generated from a seed (`--seed`, or autogenerated). That gets a speed of about 660MiB/s when writing to my SSD.

# Credit

A similar technique used here (pipe zeroes into a crypto routine) is being suggested by the [folks on archwiki](https://wiki.archlinux.org/title/Badblocks#Alternatives), but the concrete technique (write zeroes via AES-128-CTR based on a deterministic key) comes from my pal [@rwg](https://github.com/rwg) who has done & discarded more super cool hacks than many of us can dream of.
